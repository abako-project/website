
<%- include('./headers/_projects') %>

<% const client = c; %>


<% if (client) { %>
    <p>
        <button class="projectFlow" onclick="redirectProjectNew(); return false;">Create New Project</button>
    </p>
<% } %>


<section>
    <% for (let project of projects) { %>

        <article class="projectsIndex">

            <div class="title">
                <%= project.title %>
            </div>

            <div class="user" id="client">
                <% if (project.client) { %>
                    <small> <%= project.client.name %> </small>
                    <img class="attachment"
                         src="/clients/<%= project.clientId %>/attachment">
                <% } else { %>
                    <small> <%= 'none' %> </small>
                    <img class="attachment"
                         src="/images/none.png">
                <% } %>
            </div>

            <div class="user" id="consultant">
                <% if (project.consultant) { %>
                    <small> <%= project.consultant.name %> </small>
                    <img class="attachment"
                         src="/developers/<%= project.consultantId %>/attachment">
                <% } else { %>
                    <small> <%= 'none' %> </small>
                    <img class="attachment"
                         src="/images/none.png">
                <% } %>
            </div>

            <div class="user" id="developer">
                <% if (developer && project.milestones.some(m => m.tasks.some(t => t.assignation.developerId === developer.id))) { %>
                    <small> <%= developer.name %> </small>
                    <img class="attachment"
                         src="/developers/<%= developer.id %>/attachment">
                <% } %>
            </div>



            <div class="state">
                <%= project.state ?? 'Unknown' %>
            </div>

            <div class="actions">
                <button onclick="redirectProjectShow(<%= project.id %>);">Show</button>

                <% if (locals.loginUser && locals.loginUser.isAdmin) { %>

                    <button class="adminDAO" onclick="redirectProjectDelete(<%= project.id %>); return false;">Delete</button>

                <% } %>
            </div>

        </article>
    <% } %>
</section>



