<h1>Projects</h1>

<% const client = c; %>


<% if (client) { %>
    <p>
        <a is="a-with-tzo" href="/projects/new">Crear nuevo proyecto</a>
    </p>
<% } %>


<section>
    <% for (let project of projects) { %>

        <article class="projectsIndex">

            <div class="title">
                <%= project.title %>
            </div>

            <div class="user" id="client">
                <% if (project.client) { %>
                    <small> <%= project.client.name %> </small>
                    <img class="attachment"
                         src="/clients/<%= project.clientId %>/attachment">
                <% } else { %>
                    <small> <%= 'N/A' %> </small>
                    <img class="attachment"
                         src="/images/none.png">
                <% } %>
            </div>

            <div class="user" id="consultant">
                <% if (project.consultant) { %>
                    <small> <%= project.consultant.name %> </small>
                    <img class="attachment"
                         src="/developers/<%= project.consultantId %>/attachment">
                <% } else { %>
                    <small> <%= 'N/A' %> </small>
                    <img class="attachment"
                         src="/images/none.png">
                <% } %>
            </div>

            <div class="state">
                <%= project.state ?? 'Unknown' %>
            </div>

            <div class="actions">
                <button class="projectShow" data-project-id="<%= project.id %>">Show</button>

                <script type="module">
                  document.addEventListener("click", async ev => {

                    const projectId = ev.target.dataset.projectId;

                    if (ev.target.matches(".projectShow")) {
                      ev.preventDefault();
                      location.href = addTZO("/projects/" + projectId);
                    }
                  })
                </script>
            </div>

        </article>
    <% } %>
</section>



