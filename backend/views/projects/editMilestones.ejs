<% if (project.state === "scopingInProgress" ) { %>
    <%- include('./headers/_empty', {project, title: "Review the Project Scope and Milestones"}) %>
<% } else { %>
    <%- include('./headers/_empty', {project, title: "Project description"}) %>
<% } %>



<% for (const i in project.milestones) { %>

    <% const milestone = project.milestones[i]; %>

    <div class="card">

        <%- include("./milestones/_show", {milestone}) %>

        <br/>

        <% if (locals.loginUser && locals.loginUser.developerId === project.consultantId) { %>

            <button class="right milestoneEdit"
                    data-milestone-id="<%= milestone.id %>"
                    data-project-id="<%= project.id %>">Edit
            </button>
            <button class="right milestoneDelete"
                    data-milestone-id="<%= milestone.id %>"
                    data-project-id="<%= project.id %>">Delete
            </button>

            <% if (+i > 0) { %>
                <button class="right milestoneSwapOrder"
                        data-milestone-id="<%= milestone.id %>"
                        data-other-milestone-id="<%= project.milestones[+i-1].id %>"
                        data-project-id="<%= project.id %>">▲
                </button>
            <% } %>

            <% if (+i < project.milestones.length - 1) { %>
                <button class="right milestoneSwapOrder"
                        data-milestone-id="<%= milestone.id %>"
                        data-other-milestone-id="<%= project.milestones[+i+1].id %>"
                        data-project-id="<%= project.id %>">▼
                </button>
            <% } %>

            <div class="clear"></div>

        <% } %>

    </div>
<% } %>

<% if (locals.loginUser && locals.loginUser.developerId === project.consultantId) { %>
    <p>
        <a is="a-with-tzo" href="/projects/<%= project.id %>/milestones/new" id="addmilestone" class="button">Crear nuevo Milestone</a>
    </p>
<% } %>


<script type="module">
  document.addEventListener("click", async ev => {

    const projectId = ev.target.dataset.projectId;
    const milestoneId = ev.target.dataset.milestoneId;

    if (ev.target.matches(".milestoneEdit")) {
      ev.preventDefault();
      location.href = addTZO("/projects/" + projectId + "/milestones/" + milestoneId + "/edit");
    } else if (ev.target.matches(".milestoneDelete")) {
      ev.preventDefault();
      location.href = "/projects/" + projectId + "/milestones/" + milestoneId + "?_method=DELETE";
    } else if (ev.target.matches(".milestoneSwapOrder")) {
      ev.preventDefault();
      const otherMilestoneId = ev.target.dataset.otherMilestoneId;
      location.href = "/projects/" + projectId + "/milestones/swaporder/" + milestoneId + "/" + otherMilestoneId + "?_method=PUT";
    }
  })
</script>


<a is="a-with-tzo" href="/projects/<%= project.id %>/objectives_constraints/edit" class="button">back</a>


<button id="projectNextButton" data-project-id="<%= project.id %>">Next</button>
<script type="module">
  document.getElementById('projectNextButton').addEventListener('click', async ev => {

      <% if (locals.loginUser.developerId === project.consultantId &&
              project.state &&
              ["scopingInProgress"].includes(project.state)) { %>

    ev.preventDefault();
    const projectId = ev.target.dataset.projectId;
    location.href = addTZO("/projects/" + projectId);

      <% } %>

  });
</script>


